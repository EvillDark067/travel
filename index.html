<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Viagens</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
function initSupabase(){
 if(supabaseConfig.url && supabaseConfig.key){
   supabase = window.supabase.createClient(supabaseConfig.url, supabaseConfig.key);
 }
}

        tailwind.config = {
            darkMode: 'class',
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 transition-colors duration-300">
    <!-- Theme Toggle -->
    <div class="fixed top-4 right-4 z-50">
        <button id="themeToggle" class="p-2 rounded-lg bg-white dark:bg-gray-800 shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300">
            <span class="dark:hidden">üåô</span>
            <span class="hidden dark:inline">‚òÄÔ∏è</span>
        </button>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md border border-gray-200 dark:border-gray-700">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">üöó Controle de Viagens</h1>
                <p class="text-gray-600 dark:text-gray-400">Fa√ßa login para continuar</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Usu√°rio</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Digite seu usu√°rio" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Senha</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Digite sua senha" required>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-300 shadow-lg hover:shadow-xl">
                    Entrar
                </button>
            </form>
        </div>
    </div>

    <!-- Gestor Dashboard -->
    <div id="gestorDashboard" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-8 border border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white uppercase tracking-wide">üë®‚Äçüíº PAINEL DO GESTOR</h1>
                    <button onclick="logout()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-3 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                        SAIR DO SISTEMA
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Gerenciar Usu√°rios -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-5xl mb-6">üë•</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 uppercase tracking-wide">GERENCIAR USU√ÅRIOS</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 uppercase">CADASTRAR E GERENCIAR MOTORISTAS</p>
                        <button onclick="showUserManagement()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            GERENCIAR
                        </button>
                    </div>
                </div>

                <!-- Gerenciar Ve√≠culos -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-5xl mb-6">üöô</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 uppercase tracking-wide">GERENCIAR VE√çCULOS</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 uppercase">CADASTRAR E GERENCIAR FROTA</p>
                        <button onclick="showVehicleManagement()" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            GERENCIAR
                        </button>
                    </div>
                </div>

                <!-- Relat√≥rios -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-5xl mb-6">üìä</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 uppercase tracking-wide">RELAT√ìRIOS</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 uppercase">GERAR PDF DE VIAGENS</p>
                        <button onclick="showReports()" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            VISUALIZAR
                        </button>
                    </div>
                </div>

                <!-- Status Viagens -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-5xl mb-6">üó∫Ô∏è</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 uppercase tracking-wide">STATUS VIAGENS</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 uppercase">ACOMPANHAR VIAGENS</p>
                        <button onclick="showTripStatus()" class="bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            VISUALIZAR
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6 border border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-gray-800 dark:text-white">üë®‚Äçüíº Painel Administrativo</h1>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                        Sair do Sistema
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Gerenciar Usu√°rios -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-5xl mb-6">üë•</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 uppercase tracking-wide">GERENCIAR USU√ÅRIOS</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 uppercase">CADASTRAR E GERENCIAR MOTORISTAS</p>
                        <button onclick="showUserManagement()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            GERENCIAR
                        </button>
                    </div>
                </div>

                <!-- Gerenciar Ve√≠culos -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-5xl mb-6">üöô</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 uppercase tracking-wide">GERENCIAR VE√çCULOS</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 uppercase">CADASTRAR E GERENCIAR FROTA</p>
                        <button onclick="showVehicleManagement()" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            GERENCIAR
                        </button>
                    </div>
                </div>

                <!-- Relat√≥rios -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-5xl mb-6">üìä</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 uppercase tracking-wide">RELAT√ìRIOS</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 uppercase">GERAR PDF DE VIAGENS</p>
                        <button onclick="showReports()" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            VISUALIZAR
                        </button>
                    </div>
                </div>

                <!-- Data Center -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-5xl mb-6">üîó</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 uppercase tracking-wide">DATA CENTER</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 uppercase">CONFIGURAR SUPABASE</p>
                        <button onclick="showDataCenter()" class="bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            CONFIGURAR
                        </button>
                    </div>
                </div>

                <!-- Status Viagens -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-center">
                        <div class="text-5xl mb-6">üó∫Ô∏è</div>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 uppercase tracking-wide">STATUS VIAGENS</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 uppercase">ACOMPANHAR VIAGENS</p>
                        <button onclick="showTripStatus()" class="bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            VISUALIZAR
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Driver Dashboard -->
    <div id="driverDashboard" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-8 border border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white uppercase tracking-wide">üöó PAINEL DO MOTORISTA</h1>
                    <div class="space-x-2">
                        <button onclick="logout()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-3 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            SAIR DO SISTEMA
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Trip Management -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-6 uppercase tracking-wide">üéØ GERENCIAR VIAGEM</h2>
                    
                    <!-- Start Trip Form -->
                    <div id="startTripForm" class="space-y-4">
                        <div class="grid grid-cols-1 gap-4">
                            <!-- Motorista logado automaticamente -->
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center space-x-3">
                                    <span class="text-2xl">üë®‚Äçüíº</span>
                                    <div>
                                        <h4 class="font-bold text-blue-800 dark:text-blue-300 uppercase">MOTORISTA</h4>
                                        <p id="loggedDriverName" class="text-blue-700 dark:text-blue-400 font-medium"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">VE√çCULO</label>
                                <select id="vehicleSelect" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                                    <option value="">Selecione o ve√≠culo</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">KM INICIAL</label>
                                <input type="number" id="initialKm" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="DIGITE A QUILOMETRAGEM INICIAL" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">DESTINO</label>
                                <input type="text" id="destination" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="DIGITE O DESTINO" required>
                            </div>
                        </div>
                        
                        <button onclick="startTrip()" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            üöÄ INICIAR VIAGEM
                        </button>
                    </div>

                    <!-- Active Trip Display -->
                    <div id="activeTripDisplay" class="hidden">
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-200 dark:border-green-800 rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-green-800 dark:text-green-300 mb-4 uppercase tracking-wide">üü¢ VIAGEM EM ANDAMENTO</h3>
                            <div id="tripDetails" class="space-y-3 text-gray-700 dark:text-gray-300"></div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">KM FINAL</label>
                                <input type="number" id="finalKm" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="DIGITE A QUILOMETRAGEM FINAL" required>
                            </div>
                            
                            <button onclick="endTrip()" class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                üèÅ ENCERRAR VIAGEM
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Driver Trip History -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-6 uppercase tracking-wide">üìã MINHAS VIAGENS</h2>
                    
                    <div class="space-y-4">
                        <!-- Driver Stats -->
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="driverTotalTrips">0</div>
                                    <div class="text-sm text-blue-800 dark:text-blue-300 uppercase font-medium">VIAGENS</div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="driverTotalKm">0</div>
                                    <div class="text-sm text-green-800 dark:text-green-300 uppercase font-medium">KM TOTAL</div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Trips -->
                        <div class="max-h-96 overflow-y-auto">
                            <div id="driverTripsContainer" class="space-y-3">
                                <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                                    Nenhuma viagem realizada ainda
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Screen -->
    <div id="userManagementScreen" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6 border border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white uppercase tracking-wide">üë• GERENCIAMENTO DE USU√ÅRIOS</h1>
                    <div class="space-x-2">
                        <button onclick="showAdminDashboard()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Voltar ao Menu
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Sair do Sistema
                        </button>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                <div class="flex space-x-4 mb-6">
                    <button id="addUserTab" onclick="showAddUserTab()" class="px-4 py-2 bg-green-500 text-white rounded-lg transition-colors duration-300">
                        Cadastrar Usu√°rio
                    </button>
                    <button id="listUsersTab" onclick="showListUsersTab()" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300">
                        Listar Usu√°rios
                    </button>
                    <button id="adminPasswordTab" onclick="showAdminPasswordTab()" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300">
                        Alterar Senha Admin
                    </button>

                </div>

                <!-- Add User Tab -->
                <div id="addUserContent">
                    <form id="userForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">NOME DO USU√ÅRIO</label>
                                <input type="text" id="newUserName" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="DIGITE O NOME COMPLETO" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">USU√ÅRIO</label>
                                <input type="text" id="newUsername" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="DIGITE O NOME DE USU√ÅRIO" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">SENHA</label>
                                <input type="password" id="newPassword" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="DIGITE A SENHA" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">TIPO DE USU√ÅRIO</label>
                                <select id="newUserRole" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                                    <option value="">SELECIONE O TIPO</option>
                                    <option value="driver">MOTORISTA</option>
                                    <option value="gestor">GESTOR</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            CADASTRAR USU√ÅRIO
                        </button>
                    </form>
                </div>

                <!-- List Users Tab -->
                <div id="listUsersContent" class="hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300 dark:border-gray-600">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-700">
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">Nome</th>
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">Usu√°rio</th>
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">Tipo</th>
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody" class="text-gray-700 dark:text-gray-300">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Admin Password Tab -->
                <div id="adminPasswordContent" class="hidden">
                    <form id="adminPasswordForm" class="space-y-4 max-w-md">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">SENHA ATUAL</label>
                            <input type="password" id="currentAdminPassword" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="DIGITE A SENHA ATUAL" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">NOVA SENHA</label>
                            <input type="password" id="newAdminPassword" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="DIGITE A NOVA SENHA" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">CONFIRMAR NOVA SENHA</label>
                            <input type="password" id="confirmAdminPassword" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="CONFIRME A NOVA SENHA" required>
                        </div>
                        
                        <button type="submit" class="bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            ALTERAR SENHA
                        </button>
                    </form>
                </div>


            </div>
        </div>
    </div>

    <!-- Vehicle Management Screen -->
    <div id="vehicleManagementScreen" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6 border border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white uppercase tracking-wide">üöô GERENCIAMENTO DE VE√çCULOS</h1>
                    <div class="space-x-2">
                        <button onclick="showAdminDashboard()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Voltar ao Menu
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Sair do Sistema
                        </button>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                <div class="flex space-x-4 mb-6">
                    <button id="addVehicleTab" onclick="showAddVehicleTab()" class="px-4 py-2 bg-blue-500 text-white rounded-lg transition-colors duration-300">
                        Cadastrar Ve√≠culo
                    </button>
                    <button id="listVehiclesTab" onclick="showListVehiclesTab()" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300">
                        Listar Ve√≠culos
                    </button>
                </div>

                <!-- Add Vehicle Tab -->
                <div id="addVehicleContent">
                    <form id="vehicleForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">PLACA</label>
                                <input type="text" id="vehiclePlate" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="ABC-1234" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">MARCA</label>
                                <input type="text" id="vehicleBrand" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="TOYOTA, FORD, CHEVROLET..." required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">MODELO</label>
                                <input type="text" id="vehicleModel" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="COROLLA, FIESTA, ONIX..." required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">ANO</label>
                                <input type="number" id="vehicleYear" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="2020" min="1990" max="2030" required>
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            üöô CADASTRAR VE√çCULO
                        </button>
                    </form>
                </div>

                <!-- List Vehicles Tab -->
                <div id="listVehiclesContent" class="hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300 dark:border-gray-600">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-700">
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">Placa</th>
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">Marca</th>
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">Modelo</th>
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">Ano</th>
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">Status</th>
                                    <th class="border border-gray-300 dark:border-gray-600 px-4 py-2 text-left text-gray-800 dark:text-white">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="vehiclesTableBody" class="text-gray-700 dark:text-gray-300">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reports Screen -->
    <div id="reportsScreen" class="hidden min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6 border border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white uppercase tracking-wide">üìä RELAT√ìRIOS E DASHBOARD</h1>
                    <div class="space-x-2">
                        <button onclick="showAdminDashboard()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Voltar ao Menu
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Sair do Sistema
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Stats -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 border-2 border-blue-200 dark:border-blue-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-sm font-bold text-blue-800 dark:text-blue-300 uppercase">TOTAL VIAGENS</h3>
                            <p class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="dashTotalTrips">0</p>
                        </div>
                        <div class="text-4xl">üöó</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-6 border-2 border-green-200 dark:border-green-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-sm font-bold text-green-800 dark:text-green-300 uppercase">KM TOTAL</h3>
                            <p class="text-3xl font-bold text-green-600 dark:text-green-400" id="dashTotalKm">0</p>
                        </div>
                        <div class="text-4xl">üìè</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 rounded-xl p-6 border-2 border-purple-200 dark:border-purple-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-sm font-bold text-purple-800 dark:text-purple-300 uppercase">MOTORISTAS ATIVOS</h3>
                            <p class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="dashActiveDrivers">0</p>
                        </div>
                        <div class="text-4xl">üë®‚Äçüíº</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 rounded-xl p-6 border-2 border-orange-200 dark:border-orange-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-sm font-bold text-orange-800 dark:text-orange-300 uppercase">VE√çCULOS ATIVOS</h3>
                            <p class="text-3xl font-bold text-orange-600 dark:text-orange-400" id="dashActiveVehicles">0</p>
                        </div>
                        <div class="text-4xl">üöô</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Top Drivers -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6 uppercase tracking-wide">üèÜ TOP MOTORISTAS</h2>
                    <div id="topDriversList" class="space-y-4">
                        <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                            Nenhum dado dispon√≠vel
                        </div>
                    </div>
                </div>

                <!-- Top Vehicles -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6 uppercase tracking-wide">üöô VE√çCULOS MAIS UTILIZADOS</h2>
                    <div id="topVehiclesList" class="space-y-4">
                        <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                            Nenhum dado dispon√≠vel
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Generation -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6 uppercase tracking-wide">üìÑ GERAR RELAT√ìRIO</h2>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">MOTORISTA</label>
                            <select id="reportDriver" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="">TODOS OS MOTORISTAS</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase">PER√çODO</label>
                            <select id="reportPeriod" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="7">√öLTIMOS 7 DIAS</option>
                                <option value="10">√öLTIMOS 10 DIAS</option>
                                <option value="15">√öLTIMOS 15 DIAS</option>
                                <option value="30">√öLTIMOS 30 DIAS</option>
                                <option value="31">√öLTIMOS 31 DIAS</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="pt-4">
                        <button onclick="generateReport()" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-8 py-4 rounded-xl font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            üìÑ GERAR RELAT√ìRIO PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Center Screen -->
    <div id="dataCenterScreen" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6 border border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white uppercase tracking-wide">üîó DATA CENTER - CONFIGURA√á√ÉO DO SUPABASE</h1>
                    <div class="space-x-2">
                        <button onclick="showAdminDashboard()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Voltar ao Menu
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Sair do Sistema
                        </button>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                <div class="flex space-x-4 mb-6">
                    <button id="configTab" onclick="showConfigTab()" class="px-4 py-2 bg-orange-500 text-white rounded-lg transition-colors duration-300">
                        Configura√ß√£o
                    </button>
                    <button id="statusTab" onclick="showStatusTab()" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300">
                        Status & Logs
                    </button>
                    <button id="tablesTab" onclick="showTablesTab()" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300">
                        Estrutura das Tabelas
                    </button>
                </div>

                <!-- Configuration Tab -->
                <div id="configContent">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">URL do Projeto</label>
                            <input type="url" id="supabaseUrl" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="https://seu-projeto.supabase.co">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Anon Key</label>
                            <input type="password" id="supabaseKey" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
                        </div>
                        
                        <div class="flex space-x-3 pt-4">
                            <button onclick="testConnection()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg transition-colors duration-300 font-semibold">
                                Testar Conex√£o
                            </button>
                            <button onclick="saveConfig()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors duration-300 font-semibold">
                                Salvar Configura√ß√£o
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Status Tab -->
                <div id="statusContent" class="hidden">
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-lg font-medium text-gray-700 dark:text-gray-300">Status da Conex√£o:</span>
                            <span id="connectionStatus" class="px-4 py-2 rounded-full text-sm font-medium bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300">Desconectado</span>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Usu√°rios</h4>
                                <p id="usersCount" class="text-2xl font-bold text-blue-600 dark:text-blue-400">0</p>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Ve√≠culos</h4>
                                <p id="vehiclesCount" class="text-2xl font-bold text-green-600 dark:text-green-400">0</p>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Viagens</h4>
                                <p id="tripsCount" class="text-2xl font-bold text-purple-600 dark:text-purple-400">0</p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Logs de Conex√£o:</h4>
                            <div id="connectionLogs" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded p-3 h-40 overflow-y-auto text-sm text-gray-600 dark:text-gray-400 font-mono">
                                Aguardando configura√ß√£o...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tables Tab -->
                <div id="tablesContent" class="hidden">
                    <div class="space-y-6">
                        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                            <h3 class="font-semibold text-blue-800 dark:text-blue-300 mb-2">üìã Instru√ß√µes para criar as tabelas no Supabase:</h3>
                            <ol class="list-decimal list-inside space-y-1 text-sm text-blue-700 dark:text-blue-400">
                                <li>Acesse seu projeto no Supabase</li>
                                <li>V√° em "SQL Editor" no menu lateral</li>
                                <li>Copie e execute cada comando SQL abaixo</li>
                                <li>Volte aqui e teste a conex√£o</li>
                            </ol>
                        </div>

                        <div class="space-y-4">
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h4 class="font-medium text-gray-800 dark:text-white mb-2">1. Tabela de Usu√°rios:</h4>
                                <pre class="bg-gray-800 text-green-400 p-3 rounded text-sm overflow-x-auto"><code>CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  username VARCHAR(100) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  role VARCHAR(20) DEFAULT 'driver',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);</code></pre>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h4 class="font-medium text-gray-800 dark:text-white mb-2">2. Tabela de Ve√≠culos:</h4>
                                <pre class="bg-gray-800 text-green-400 p-3 rounded text-sm overflow-x-auto"><code>CREATE TABLE vehicles (
  id SERIAL PRIMARY KEY,
  plate VARCHAR(20) UNIQUE NOT NULL,
  model VARCHAR(255) NOT NULL,
  year INTEGER NOT NULL,
  available BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);</code></pre>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h4 class="font-medium text-gray-800 dark:text-white mb-2">3. Tabela de Viagens:</h4>
                                <pre class="bg-gray-800 text-green-400 p-3 rounded text-sm overflow-x-auto"><code>CREATE TABLE trips (
  id SERIAL PRIMARY KEY,
  driver_id INTEGER REFERENCES users(id),
  vehicle_id INTEGER REFERENCES vehicles(id),
  destination VARCHAR(255) NOT NULL,
  initial_km INTEGER NOT NULL,
  final_km INTEGER,
  km_traveled INTEGER,
  start_time TIMESTAMP NOT NULL,
  end_time TIMESTAMP,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);</code></pre>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h4 class="font-medium text-gray-800 dark:text-white mb-2">4. Inserir usu√°rio admin inicial:</h4>
                                <pre class="bg-gray-800 text-green-400 p-3 rounded text-sm overflow-x-auto"><code>INSERT INTO users (name, username, password, role) 
VALUES ('Administrador', 'admin', 'admin123', 'admin');</code></pre>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h4 class="font-medium text-gray-800 dark:text-white mb-2">5. Desabilitar RLS (para testes):</h4>
                                <pre class="bg-gray-800 text-green-400 p-3 rounded text-sm overflow-x-auto"><code>ALTER TABLE users DISABLE ROW LEVEL SECURITY;
ALTER TABLE vehicles DISABLE ROW LEVEL SECURITY;
ALTER TABLE trips DISABLE ROW LEVEL SECURITY;</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trip Status Screen -->
    <div id="tripStatusScreen" class="hidden min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6 border border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white uppercase tracking-wide">üó∫Ô∏è STATUS DAS VIAGENS</h1>
                    <div class="space-x-2">
                        <button onclick="showAdminDashboard()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Voltar ao Menu
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-300">
                            Sair do Sistema
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Quick Stats -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-6 border-2 border-green-200 dark:border-green-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-bold text-green-800 dark:text-green-300 uppercase">EM TR√ÇNSITO</h3>
                            <p class="text-3xl font-bold text-green-600 dark:text-green-400" id="activeTripsCount">0</p>
                        </div>
                        <div class="text-4xl">üöó</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 border-2 border-blue-200 dark:border-blue-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-bold text-blue-800 dark:text-blue-300 uppercase">ENCERRADAS</h3>
                            <p class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="completedTripsCount">0</p>
                        </div>
                        <div class="text-4xl">üèÅ</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 rounded-xl p-6 border-2 border-purple-200 dark:border-purple-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-bold text-purple-800 dark:text-purple-300 uppercase">KM TOTAL</h3>
                            <p class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="totalKmCount">0</p>
                        </div>
                        <div class="text-4xl">üìä</div>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                <div class="flex space-x-4 mb-6">
                    <button id="activeTripsTab" onclick="showActiveTrips()" class="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold uppercase tracking-wide shadow-lg transition-all duration-300">
                        üöó EM TR√ÇNSITO
                    </button>
                    <button id="completedTripsTab" onclick="showCompletedTrips()" class="px-6 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl font-bold uppercase tracking-wide transition-all duration-300">
                        üèÅ ENCERRADAS
                    </button>
                </div>
                
                <!-- Active Trips -->
                <div id="activeTripsContent">
                    <div id="activeTripsCards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="col-span-full text-center text-gray-500 dark:text-gray-400 py-12">
                            <div class="text-6xl mb-4">üöó</div>
                            <p class="text-xl font-medium">Nenhuma viagem em andamento</p>
                        </div>
                    </div>
                </div>
                
                <!-- Completed Trips -->
                <div id="completedTripsContent" class="hidden">
                    <div class="mb-6 flex flex-col sm:flex-row gap-4">
                        <input type="text" id="tripSearchFilter" placeholder="üîç Buscar viagem..." class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <button onclick="exportCSV()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-lg font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            üìä EXPORTAR CSV
                        </button>
                    </div>
                    
                    <div id="completedTripsTable" class="overflow-x-auto">
                        <table class="w-full border-collapse bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-lg">
                            <thead>
                                <tr class="bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600">
                                    <th class="px-6 py-4 text-left text-gray-800 dark:text-white font-bold uppercase tracking-wide">MOTORISTA</th>
                                    <th class="px-6 py-4 text-left text-gray-800 dark:text-white font-bold uppercase tracking-wide">VE√çCULO</th>
                                    <th class="px-6 py-4 text-left text-gray-800 dark:text-white font-bold uppercase tracking-wide">DESTINO</th>
                                    <th class="px-6 py-4 text-left text-gray-800 dark:text-white font-bold uppercase tracking-wide">IN√çCIO</th>
                                    <th class="px-6 py-4 text-left text-gray-800 dark:text-white font-bold uppercase tracking-wide">FIM</th>
                                    <th class="px-6 py-4 text-left text-gray-800 dark:text-white font-bold uppercase tracking-wide">KM</th>
                                </tr>
                            </thead>
                            <tbody id="completedTripsBody" class="text-gray-700 dark:text-gray-300">
                                <tr>
                                    <td colspan="6" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                                        <div class="text-6xl mb-4">üèÅ</div>
                                        <p class="text-xl font-medium">Nenhuma viagem encerrada</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
function initSupabase(){
 if(supabaseConfig.url && supabaseConfig.key){
   supabase = window.supabase.createClient(supabaseConfig.url, supabaseConfig.key);
 }
}

        // Global variables
        let currentUser = null;
        let users = [
            { id: 1, name: 'Administrador', username: 'admin', password: 'admin123', role: 'admin' }
        ];
        let vehicles = [];
        let trips = [];
        let activeTrip = null;
        let supabaseConfig = { url: '', key: '' };

        // Theme management
        function initTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.classList.toggle('dark', theme === 'dark');
        }

        document.getElementById('themeToggle').addEventListener('click', function() {
            document.documentElement.classList.toggle('dark');
            const theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', theme);
        });

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                hideAllScreens();
                
                if (user.role === 'admin') {
                    document.getElementById('adminDashboard').classList.remove('hidden');
                } else if (user.role === 'gestor') {
                    document.getElementById('gestorDashboard').classList.remove('hidden');
                } else {
                    document.getElementById('driverDashboard').classList.remove('hidden');
                    loadDriverData();
                }
            } else {
                alert('Usu√°rio ou senha incorretos!');
            }
        });

        // Logout functionality
        function logout() {
            currentUser = null;
            activeTrip = null;
            hideAllScreens();
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('loginForm').reset();
        }

        // Screen management functions are now handled by hideAllScreens() and individual show functions

        // Admin functions
        function showUserManagement() {
            hideAllScreens();
            updateUsersTable();
            document.getElementById('userManagementScreen').classList.remove('hidden');
            showAddUserTab();
        }

        function showVehicleManagement() {
            hideAllScreens();
            updateVehiclesTable();
            document.getElementById('vehicleManagementScreen').classList.remove('hidden');
            showAddVehicleTab();
        }

        function showReports() {
            hideAllScreens();
            updateReportDrivers();
            updateDashboardStats();
            updateTopDrivers();
            updateTopVehicles();
            document.getElementById('reportsScreen').classList.remove('hidden');
        }

        function updateDashboardStats() {
            const completedTrips = trips.filter(t => t.status === 'completed');
            const totalTrips = completedTrips.length;
            const totalKm = completedTrips.reduce((sum, trip) => sum + (trip.kmTraveled || 0), 0);
            const activeDrivers = users.filter(u => u.role === 'driver' && trips.some(t => t.driverId === u.id && t.status === 'completed')).length;
            const activeVehicles = vehicles.filter(v => trips.some(t => t.vehicleId === v.id && t.status === 'completed')).length;
            
            document.getElementById('dashTotalTrips').textContent = totalTrips;
            document.getElementById('dashTotalKm').textContent = totalKm;
            document.getElementById('dashActiveDrivers').textContent = activeDrivers;
            document.getElementById('dashActiveVehicles').textContent = activeVehicles;
        }

        function updateTopDrivers() {
            const driverStats = {};
            
            trips.filter(t => t.status === 'completed').forEach(trip => {
                if (!driverStats[trip.driverId]) {
                    const driver = users.find(u => u.id === trip.driverId);
                    driverStats[trip.driverId] = {
                        name: driver ? driver.name : 'Motorista n√£o encontrado',
                        trips: 0,
                        km: 0
                    };
                }
                driverStats[trip.driverId].trips++;
                driverStats[trip.driverId].km += trip.kmTraveled || 0;
            });
            
            const topDrivers = Object.values(driverStats)
                .sort((a, b) => b.trips - a.trips)
                .slice(0, 5);
            
            const container = document.getElementById('topDriversList');
            
            if (topDrivers.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        Nenhum dado dispon√≠vel
                    </div>
                `;
                return;
            }
            
            container.innerHTML = topDrivers.map((driver, index) => `
                <div class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-blue-50 dark:from-gray-700 dark:to-blue-900/20 rounded-lg border border-gray-200 dark:border-gray-600">
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">${index + 1}¬∫</div>
                        <div>
                            <h4 class="font-bold text-gray-800 dark:text-white">${driver.name}</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${driver.trips} viagens ‚Ä¢ ${driver.km} km</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-blue-600 dark:text-blue-400">${driver.trips}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 uppercase">viagens</div>
                    </div>
                </div>
            `).join('');
        }

        function updateTopVehicles() {
            const vehicleStats = {};
            
            trips.filter(t => t.status === 'completed').forEach(trip => {
                if (!vehicleStats[trip.vehicleId]) {
                    const vehicle = vehicles.find(v => v.id === trip.vehicleId);
                    vehicleStats[trip.vehicleId] = {
                        plate: vehicle ? vehicle.plate : 'N/A',
                        brand: vehicle ? vehicle.brand : 'N/A',
                        model: vehicle ? vehicle.model : 'N/A',
                        trips: 0,
                        km: 0
                    };
                }
                vehicleStats[trip.vehicleId].trips++;
                vehicleStats[trip.vehicleId].km += trip.kmTraveled || 0;
            });
            
            const topVehicles = Object.values(vehicleStats)
                .sort((a, b) => b.trips - a.trips)
                .slice(0, 5);
            
            const container = document.getElementById('topVehiclesList');
            
            if (topVehicles.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        Nenhum dado dispon√≠vel
                    </div>
                `;
                return;
            }
            
            container.innerHTML = topVehicles.map((vehicle, index) => `
                <div class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-green-50 dark:from-gray-700 dark:to-green-900/20 rounded-lg border border-gray-200 dark:border-gray-600">
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl font-bold text-green-600 dark:text-green-400">${index + 1}¬∫</div>
                        <div>
                            <h4 class="font-bold text-gray-800 dark:text-white font-mono">${vehicle.plate}</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${vehicle.brand} ${vehicle.model}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-green-600 dark:text-green-400">${vehicle.trips}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 uppercase">viagens</div>
                    </div>
                </div>
            `).join('');
        }

        function showDataCenter() {
            if (currentUser.role !== 'admin') {
                alert('Acesso negado! Apenas administradores podem acessar o Data Center.');
                return;
            }
            hideAllScreens();
            document.getElementById('dataCenterScreen').classList.remove('hidden');
            showConfigTab();
        }

        function showTripStatus() {
            hideAllScreens();
            updateTripStatusTables();
            document.getElementById('tripStatusScreen').classList.remove('hidden');
        }

        function showAdminDashboard() {
            hideAllScreens();
            document.getElementById('adminDashboard').classList.remove('hidden');
        }

        function hideAllScreens() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('gestorDashboard').classList.add('hidden');
            document.getElementById('driverDashboard').classList.add('hidden');
            document.getElementById('userManagementScreen').classList.add('hidden');
            document.getElementById('vehicleManagementScreen').classList.add('hidden');
            document.getElementById('reportsScreen').classList.add('hidden');
            document.getElementById('dataCenterScreen').classList.add('hidden');
            document.getElementById('tripStatusScreen').classList.add('hidden');
        }

        // User Management Tabs
        function showAddUserTab() {
            document.getElementById('addUserContent').classList.remove('hidden');
            document.getElementById('listUsersContent').classList.add('hidden');
            document.getElementById('adminPasswordContent').classList.add('hidden');
            
            document.getElementById('addUserTab').className = 'px-4 py-2 bg-green-500 text-white rounded-lg transition-colors duration-300';
            document.getElementById('listUsersTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            document.getElementById('adminPasswordTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
        }

        function showListUsersTab() {
            document.getElementById('addUserContent').classList.add('hidden');
            document.getElementById('listUsersContent').classList.remove('hidden');
            document.getElementById('adminPasswordContent').classList.add('hidden');
            
            document.getElementById('addUserTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            document.getElementById('listUsersTab').className = 'px-4 py-2 bg-green-500 text-white rounded-lg transition-colors duration-300';
            document.getElementById('adminPasswordTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            
            updateUsersTable();
        }

        function showAdminPasswordTab() {
            document.getElementById('addUserContent').classList.add('hidden');
            document.getElementById('listUsersContent').classList.add('hidden');
            document.getElementById('adminPasswordContent').classList.remove('hidden');
            
            document.getElementById('addUserTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            document.getElementById('listUsersTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            document.getElementById('adminPasswordTab').className = 'px-4 py-2 bg-green-500 text-white rounded-lg transition-colors duration-300';
        }



        // Vehicle Management Tabs
        function showAddVehicleTab() {
            document.getElementById('addVehicleContent').classList.remove('hidden');
            document.getElementById('listVehiclesContent').classList.add('hidden');
            
            document.getElementById('addVehicleTab').className = 'px-4 py-2 bg-blue-500 text-white rounded-lg transition-colors duration-300';
            document.getElementById('listVehiclesTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
        }

        function showListVehiclesTab() {
            document.getElementById('addVehicleContent').classList.add('hidden');
            document.getElementById('listVehiclesContent').classList.remove('hidden');
            
            document.getElementById('addVehicleTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            document.getElementById('listVehiclesTab').className = 'px-4 py-2 bg-blue-500 text-white rounded-lg transition-colors duration-300';
            
            updateVehiclesTable();
        }

        // Data Center Tabs
        function showConfigTab() {
            document.getElementById('configContent').classList.remove('hidden');
            document.getElementById('statusContent').classList.add('hidden');
            document.getElementById('tablesContent').classList.add('hidden');
            
            document.getElementById('configTab').className = 'px-4 py-2 bg-orange-500 text-white rounded-lg transition-colors duration-300';
            document.getElementById('statusTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            document.getElementById('tablesTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
        }

        function showStatusTab() {
            document.getElementById('configContent').classList.add('hidden');
            document.getElementById('statusContent').classList.remove('hidden');
            document.getElementById('tablesContent').classList.add('hidden');
            
            document.getElementById('configTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            document.getElementById('statusTab').className = 'px-4 py-2 bg-orange-500 text-white rounded-lg transition-colors duration-300';
            document.getElementById('tablesTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            
            updateDataCenterStats();
        }

        function showTablesTab() {
            document.getElementById('configContent').classList.add('hidden');
            document.getElementById('statusContent').classList.add('hidden');
            document.getElementById('tablesContent').classList.remove('hidden');
            
            document.getElementById('configTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            document.getElementById('statusTab').className = 'px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-300';
            document.getElementById('tablesTab').className = 'px-4 py-2 bg-orange-500 text-white rounded-lg transition-colors duration-300';
        }

        // User registration
        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('newUserName').value.trim();
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('newUserRole').value;
            
            console.log('Dados do formul√°rio:', { name, username, password, role }); // Debug
            
            if (!name) {
                alert('Digite o nome do usu√°rio!');
                return;
            }
            
            if (!username) {
                alert('Digite o nome de usu√°rio!');
                return;
            }
            
            if (!password) {
                alert('Digite a senha!');
                return;
            }
            
            if (!role) {
                alert('Selecione o tipo de usu√°rio!');
                return;
            }
            
            if (users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
                alert('Este nome de usu√°rio j√° existe!');
                return;
            }
            
            if (password.length < 6) {
                alert('A senha deve ter pelo menos 6 caracteres!');
                return;
            }
            
            const newUser = {
                id: Date.now(), // Usar timestamp para ID √∫nico
                name: name,
                username: username,
                password: password,
                role: role
            };
            
            users.push(newUser);
            console.log('Usu√°rio adicionado:', newUser); // Debug
            console.log('Lista de usu√°rios:', users); // Debug
            
            alert(`${role === 'gestor' ? 'Gestor' : 'Motorista'} cadastrado com sucesso!`);
            this.reset();
            updateUsersTable();
            
            // Atualizar selects se necess√°rio
            if (role === 'driver') {
                loadDriverData();
                updateReportDrivers();
            }
        });

        // Admin password change
        document.getElementById('adminPasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentAdminPassword').value;
            const newPassword = document.getElementById('newAdminPassword').value;
            const confirmPassword = document.getElementById('confirmAdminPassword').value;
            
            const admin = users.find(u => u.role === 'admin');
            
            if (admin.password !== currentPassword) {
                alert('Senha atual incorreta!');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('As senhas n√£o coincidem!');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('A nova senha deve ter pelo menos 6 caracteres!');
                return;
            }
            
            admin.password = newPassword;
            alert('Senha alterada com sucesso!');
            this.reset();
        });



        // Update users table
        function updateUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            
            if (users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="border border-gray-300 dark:border-gray-600 px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                            Nenhum usu√°rio cadastrado
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${user.name}</td>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${user.username}</td>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs font-medium ${user.role === 'admin' ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' : user.role === 'gestor' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' : 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'}">
                            ${user.role === 'admin' ? 'ADMINISTRADOR' : user.role === 'gestor' ? 'GESTOR' : 'MOTORISTA'}
                        </span>
                    </td>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">
                        <div class="flex space-x-2">
                            ${user.role !== 'admin' ? `
                                <button onclick="changeUserPassword(${user.id})" class="bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white px-4 py-2 rounded-lg text-sm font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                    ALTERAR SENHA
                                </button>
                                <button onclick="deleteUser(${user.id})" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-2 rounded-lg text-sm font-bold uppercase tracking-wide shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                    EXCLUIR
                                </button>
                            ` : '<span class="text-gray-500 dark:text-gray-400 text-sm uppercase font-bold">PROTEGIDO</span>'}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Change user password
        function changeUserPassword(userId) {
            const user = users.find(u => u.id === userId);
            const newPassword = prompt(`Digite a nova senha para ${user.name}:`);
            
            if (newPassword && newPassword.length >= 6) {
                user.password = newPassword;
                alert('Senha alterada com sucesso!');
            } else if (newPassword) {
                alert('A senha deve ter pelo menos 6 caracteres!');
            }
        }

        // Delete user
        function deleteUser(userId) {
            const user = users.find(u => u.id === userId);
            
            if (confirm(`Tem certeza que deseja excluir o usu√°rio ${user.name}?`)) {
                const index = users.findIndex(u => u.id === userId);
                users.splice(index, 1);
                updateUsersTable();
                alert('Usu√°rio exclu√≠do com sucesso!');
            }
        }

        // Vehicle registration
        document.getElementById('vehicleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const plate = document.getElementById('vehiclePlate').value.toUpperCase();
            const brand = document.getElementById('vehicleBrand').value;
            const model = document.getElementById('vehicleModel').value;
            const year = document.getElementById('vehicleYear').value;
            
            if (vehicles.find(v => v.plate === plate)) {
                alert('Ve√≠culo j√° cadastrado!');
                return;
            }
            
            const newVehicle = {
                id: Date.now(),
                plate: plate,
                brand: brand,
                model: model,
                year: parseInt(year),
                available: true
            };
            
            vehicles.push(newVehicle);
            alert('Ve√≠culo cadastrado com sucesso!');
            this.reset();
            updateVehiclesTable();
            updateVehicleSelect();
        });

        // Update vehicles table
        function updateVehiclesTable() {
            const tbody = document.getElementById('vehiclesTableBody');
            
            if (vehicles.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="border border-gray-300 dark:border-gray-600 px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                            Nenhum ve√≠culo cadastrado
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = vehicles.map(vehicle => `
                <tr>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2 font-mono">${vehicle.plate}</td>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${vehicle.brand || 'N/A'}</td>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${vehicle.model}</td>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${vehicle.year}</td>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs font-medium ${vehicle.available ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'}">
                            ${vehicle.available ? 'Dispon√≠vel' : 'Em Uso'}
                        </span>
                    </td>
                    <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">
                        <div class="flex space-x-2">
                            <button onclick="editVehicle(${vehicle.id})" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm transition-colors duration-300">
                                Editar
                            </button>
                            <button onclick="deleteVehicle(${vehicle.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors duration-300">
                                Excluir
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Edit vehicle
        function editVehicle(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            
            const newPlate = prompt('Nova placa:', vehicle.plate);
            if (newPlate === null) return;
            
            const newModel = prompt('Novo modelo:', vehicle.model);
            if (newModel === null) return;
            
            const newYear = prompt('Novo ano:', vehicle.year);
            if (newYear === null) return;
            
            // Check if new plate already exists (excluding current vehicle)
            if (newPlate !== vehicle.plate && vehicles.find(v => v.plate === newPlate.toUpperCase())) {
                alert('Esta placa j√° est√° cadastrada!');
                return;
            }
            
            vehicle.plate = newPlate.toUpperCase();
            vehicle.model = newModel;
            vehicle.year = parseInt(newYear);
            
            updateVehiclesTable();
            updateVehicleSelect();
            alert('Ve√≠culo atualizado com sucesso!');
        }

        // Delete vehicle
        function deleteVehicle(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            
            // Check if vehicle is in use
            const activeTrip = trips.find(t => t.vehicleId === vehicleId && t.status === 'active');
            if (activeTrip) {
                alert('N√£o √© poss√≠vel excluir um ve√≠culo que est√° em uso!');
                return;
            }
            
            if (confirm(`Tem certeza que deseja excluir o ve√≠culo ${vehicle.plate}?`)) {
                const index = vehicles.findIndex(v => v.id === vehicleId);
                vehicles.splice(index, 1);
                updateVehiclesTable();
                updateVehicleSelect();
                alert('Ve√≠culo exclu√≠do com sucesso!');
            }
        }

        // Driver functions
        function showDriverMenu() {
            // This would show a driver menu if needed
        }

        function loadDriverData() {
            // Mostrar nome do motorista logado
            document.getElementById('loggedDriverName').textContent = currentUser.name;

            // Load available vehicles
            updateVehicleSelect();
            
            // Check for active trip
            checkActiveTrip();
            
            // Update driver stats and trips
            updateDriverStats();
            updateDriverTrips();
        }

        function updateDriverStats() {
            if (!currentUser || currentUser.role !== 'driver') return;
            
            const driverTrips = trips.filter(t => t.driverId === currentUser.id && t.status === 'completed');
            const totalTrips = driverTrips.length;
            const totalKm = driverTrips.reduce((sum, trip) => sum + (trip.kmTraveled || 0), 0);
            
            document.getElementById('driverTotalTrips').textContent = totalTrips;
            document.getElementById('driverTotalKm').textContent = totalKm;
        }

        function updateDriverTrips() {
            if (!currentUser || currentUser.role !== 'driver') return;
            
            const container = document.getElementById('driverTripsContainer');
            const driverTrips = trips.filter(t => t.driverId === currentUser.id && t.status === 'completed')
                                    .sort((a, b) => new Date(b.endTime) - new Date(a.endTime))
                                    .slice(0, 10); // Show last 10 trips
            
            if (driverTrips.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        Nenhuma viagem realizada ainda
                    </div>
                `;
                return;
            }
            
            container.innerHTML = driverTrips.map(trip => {
                const vehicle = vehicles.find(v => v.id === trip.vehicleId);
                return `
                    <div class="bg-gradient-to-r from-gray-50 to-blue-50 dark:from-gray-700 dark:to-blue-900/20 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-800 dark:text-white uppercase">${trip.destination}</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    üöó ${vehicle ? `${vehicle.plate} - ${vehicle.brand} ${vehicle.model}` : 'Ve√≠culo n√£o encontrado'}
                                </p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    üìÖ ${new Date(trip.startTime).toLocaleDateString('pt-BR')}
                                </p>
                            </div>
                            <div class="text-right">
                                <div class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full text-sm font-bold">
                                    ${trip.kmTraveled} KM
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateVehicleSelect() {
            const vehicleSelect = document.getElementById('vehicleSelect');
            vehicleSelect.innerHTML = '<option value="">Selecione o ve√≠culo</option>';
            vehicles.filter(v => v.available).forEach(vehicle => {
                const option = document.createElement('option');
                option.value = vehicle.id;
                option.textContent = `${vehicle.plate} - ${vehicle.model} (${vehicle.year})`;
                vehicleSelect.appendChild(option);
            });
        }

        function checkActiveTrip() {
            const userActiveTrip = trips.find(t => t.driverId === currentUser.id && t.status === 'active');
            if (userActiveTrip) {
                activeTrip = userActiveTrip;
                showActiveTripDisplay();
            } else {
                showStartTripForm();
            }
        }

        function showStartTripForm() {
            document.getElementById('startTripForm').classList.remove('hidden');
            document.getElementById('activeTripDisplay').classList.add('hidden');
        }

        function showActiveTripDisplay() {
            document.getElementById('startTripForm').classList.add('hidden');
            document.getElementById('activeTripDisplay').classList.remove('hidden');
            
            const vehicle = vehicles.find(v => v.id === activeTrip.vehicleId);
            const driver = users.find(u => u.id === activeTrip.driverId);
            
            document.getElementById('tripDetails').innerHTML = `
                <p><strong>Motorista:</strong> ${driver.name}</p>
                <p><strong>Ve√≠culo:</strong> ${vehicle.plate} - ${vehicle.model}</p>
                <p><strong>Destino:</strong> ${activeTrip.destination}</p>
                <p><strong>In√≠cio:</strong> ${new Date(activeTrip.startTime).toLocaleString('pt-BR')}</p>
                <p><strong>KM Inicial:</strong> ${activeTrip.initialKm}</p>
            `;
        }

        function startTrip() {
            const driverId = currentUser.id; // Usar o ID do motorista logado
            const vehicleId = document.getElementById('vehicleSelect').value;
            const initialKm = document.getElementById('initialKm').value;
            const destination = document.getElementById('destination').value;
            
            if (!vehicleId || !initialKm || !destination) {
                alert('Preencha todos os campos!');
                return;
            }
            
            // Check if vehicle is available
            const vehicle = vehicles.find(v => v.id == vehicleId);
            if (!vehicle.available) {
                alert('Ve√≠culo n√£o dispon√≠vel!');
                return;
            }
            
            const trip = {
                id: trips.length + 1,
                driverId: parseInt(driverId),
                vehicleId: parseInt(vehicleId),
                destination: destination,
                initialKm: parseInt(initialKm),
                startTime: new Date().toISOString(),
                status: 'active'
            };
            
            trips.push(trip);
            activeTrip = trip;
            
            // Mark vehicle as unavailable
            vehicle.available = false;
            
            showActiveTripDisplay();
            alert('Viagem iniciada com sucesso!');
        }

        function endTrip() {
            const finalKm = document.getElementById('finalKm').value;
            
            if (!finalKm) {
                alert('Digite a quilometragem final!');
                return;
            }
            
            if (parseInt(finalKm) < activeTrip.initialKm) {
                alert('A quilometragem final n√£o pode ser menor que a inicial!');
                return;
            }
            
            activeTrip.finalKm = parseInt(finalKm);
            activeTrip.endTime = new Date().toISOString();
            activeTrip.status = 'completed';
            activeTrip.kmTraveled = activeTrip.finalKm - activeTrip.initialKm;
            
            // Mark vehicle as available
            const vehicle = vehicles.find(v => v.id === activeTrip.vehicleId);
            vehicle.available = true;
            
            activeTrip = null;
            showStartTripForm();
            updateVehicleSelect();
            updateDriverStats();
            updateDriverTrips();
            
            alert('Viagem encerrada com sucesso!');
        }

        // Reports
        function updateReportDrivers() {
            const reportDriver = document.getElementById('reportDriver');
            reportDriver.innerHTML = '<option value="">Todos os motoristas</option>';
            users.filter(u => u.role === 'driver').forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                reportDriver.appendChild(option);
            });
        }

        function generateReport() {
            const driverId = document.getElementById('reportDriver').value;
            const period = parseInt(document.getElementById('reportPeriod').value);
            
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - period);
            
            let filteredTrips = trips.filter(t => {
                const tripDate = new Date(t.startTime);
                return t.status === 'completed' && tripDate >= startDate && tripDate <= endDate;
            });
            
            if (driverId) {
                filteredTrips = filteredTrips.filter(t => t.driverId == driverId);
            }
            
            if (filteredTrips.length === 0) {
                alert('Nenhuma viagem encontrada no per√≠odo selecionado!');
                return;
            }
            
            // Create PDF using jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.setFont(undefined, 'bold');
            doc.text('RELAT√ìRIO DE VIAGENS', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`Per√≠odo: ${startDate.toLocaleDateString('pt-BR')} a ${endDate.toLocaleDateString('pt-BR')}`, 105, 30, { align: 'center' });
            
            const driverName = driverId ? users.find(u => u.id == driverId)?.name : 'Todos os motoristas';
            doc.text(`Motorista: ${driverName}`, 105, 40, { align: 'center' });
            
            // Summary
            const totalKm = filteredTrips.reduce((sum, trip) => sum + (trip.kmTraveled || 0), 0);
            doc.text(`Total de viagens: ${filteredTrips.length}`, 20, 55);
            doc.text(`Total de KM: ${totalKm}`, 20, 65);
            
            // Line separator
            doc.line(20, 75, 190, 75);
            
            let yPosition = 85;
            
            filteredTrips.forEach((trip, index) => {
                // Check if we need a new page
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const driver = users.find(u => u.id === trip.driverId);
                const vehicle = vehicles.find(v => v.id === trip.vehicleId);
                
                // Trip header
                doc.setFont(undefined, 'bold');
                doc.text(`VIAGEM ${index + 1}`, 20, yPosition);
                yPosition += 10;
                
                doc.setFont(undefined, 'normal');
                doc.text(`Motorista: ${driver?.name || 'N/A'}`, 20, yPosition);
                yPosition += 7;
                
                doc.text(`Ve√≠culo: ${vehicle?.plate || 'N/A'} - ${vehicle?.brand || ''} ${vehicle?.model || ''}`, 20, yPosition);
                yPosition += 7;
                
                doc.text(`Destino: ${trip.destination}`, 20, yPosition);
                yPosition += 7;
                
                doc.text(`Data/Hora In√≠cio: ${new Date(trip.startTime).toLocaleString('pt-BR')}`, 20, yPosition);
                yPosition += 7;
                
                doc.text(`Data/Hora Fim: ${new Date(trip.endTime).toLocaleString('pt-BR')}`, 20, yPosition);
                yPosition += 7;
                
                doc.text(`KM Inicial: ${trip.initialKm}`, 20, yPosition);
                yPosition += 7;
                
                doc.text(`KM Final: ${trip.finalKm}`, 20, yPosition);
                yPosition += 7;
                
                doc.setFont(undefined, 'bold');
                doc.text(`KM Percorrida: ${trip.kmTraveled}`, 20, yPosition);
                yPosition += 10;
                
                // Signature line
                doc.setFont(undefined, 'normal');
                doc.text('Assinatura: ________________________________', 20, yPosition);
                yPosition += 15;
                
                // Separator line
                if (index < filteredTrips.length - 1) {
                    doc.line(20, yPosition, 190, yPosition);
                    yPosition += 10;
                }
            });
            
            // Footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(10);
                doc.text(`P√°gina ${i} de ${pageCount}`, 105, 285, { align: 'center' });
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 105, 292, { align: 'center' });
            }
            
            // Save PDF
            const fileName = `relatorio_viagens_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
            
            alert('Relat√≥rio PDF gerado com sucesso!');
        }

        // Data Center
        function testConnection() {
            const url = document.getElementById('supabaseUrl').value;
            const key = document.getElementById('supabaseKey').value;
            
            if (!url || !key) {
                alert('Preencha todos os campos!');
                return;
            }
            
            const logs = document.getElementById('connectionLogs');
            const status = document.getElementById('connectionStatus');
            
            logs.innerHTML = 'Testando conex√£o...\n';
            
            // Simulate connection test
            setTimeout(() => {
                logs.innerHTML += 'Verificando URL do projeto...\n';
                setTimeout(() => {
                    logs.innerHTML += 'Validando chave de API...\n';
                    setTimeout(() => {
                        logs.innerHTML += 'Testando acesso √†s tabelas...\n';
                        setTimeout(() => {
                            if (url.includes('supabase.co') && key.length > 50) {
                                logs.innerHTML += 'Conex√£o estabelecida com sucesso!\n';
                                logs.innerHTML += 'Todas as tabelas acess√≠veis.\n';
                                logs.innerHTML += 'Sincroniza√ß√£o de dados ativa.\n';
                                status.textContent = 'Online';
                                status.className = 'px-4 py-2 rounded-full text-sm font-medium bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200';
                                supabaseConfig = { url, key };
                                updateDataCenterStats();
                            } else {
                                logs.innerHTML += 'Erro na conex√£o. Verifique as credenciais.\n';
                                status.textContent = 'Offline';
                                status.className = 'px-4 py-2 rounded-full text-sm font-medium bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200';
                            }
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 1000);
        }

        function saveConfig() {
            const url = document.getElementById('supabaseUrl').value;
            const key = document.getElementById('supabaseKey').value;
            
            if (!url || !key) {
                alert('Preencha todos os campos!');
                return;
            }
            
            supabaseConfig = { url, key };
            localStorage.setItem('supabaseConfig', JSON.stringify(supabaseConfig));
            alert('Configura√ß√£o salva com sucesso!');
        }

        function updateDataCenterStats() {
            document.getElementById('usersCount').textContent = users.length;
            document.getElementById('vehiclesCount').textContent = vehicles.length;
            document.getElementById('tripsCount').textContent = trips.length;
        }

        // Load saved config on startup
        function loadSavedConfig() {
            const saved = localStorage.getItem('supabaseConfig');
            if (saved) {
                const config = JSON.parse(saved);
                document.getElementById('supabaseUrl').value = config.url;
                document.getElementById('supabaseKey').value = config.key;
                supabaseConfig = config;
            }
        }

        // Trip Status
        function updateTripStatusTables() {
            updateActiveTripsCards();
            updateCompletedTripsTable();
            updateTripStatusStats();
        }

        function updateTripStatusStats() {
            const activeTrips = trips.filter(t => t.status === 'active');
            const completedTrips = trips.filter(t => t.status === 'completed');
            const totalKm = completedTrips.reduce((sum, trip) => sum + (trip.kmTraveled || 0), 0);
            
            document.getElementById('activeTripsCount').textContent = activeTrips.length;
            document.getElementById('completedTripsCount').textContent = completedTrips.length;
            document.getElementById('totalKmCount').textContent = totalKm;
        }

        function updateActiveTripsCards() {
            const container = document.getElementById('activeTripsCards');
            const activeTrips = trips.filter(t => t.status === 'active');
            
            if (activeTrips.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center text-gray-500 dark:text-gray-400 py-12">
                        <div class="text-6xl mb-4">üöó</div>
                        <p class="text-xl font-medium">Nenhuma viagem em andamento</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = activeTrips.map(trip => {
                const driver = users.find(u => u.id === trip.driverId);
                const vehicle = vehicles.find(v => v.id === trip.vehicleId);
                const startTime = new Date(trip.startTime);
                const duration = Math.floor((new Date() - startTime) / (1000 * 60)); // minutes
                
                return `
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-6 border-2 border-green-200 dark:border-green-800 shadow-lg">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                <h3 class="text-lg font-bold text-green-800 dark:text-green-300 uppercase">EM TR√ÇNSITO</h3>
                            </div>
                            <div class="text-2xl">üöó</div>
                        </div>
                        
                        <div class="space-y-3">
                            <div>
                                <h4 class="font-bold text-gray-800 dark:text-white text-lg">${trip.destination}</h4>
                            </div>
                            
                            <div class="grid grid-cols-1 gap-2 text-sm">
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-600 dark:text-gray-400">üë®‚Äçüíº</span>
                                    <span class="text-gray-700 dark:text-gray-300">${driver ? driver.name : 'N/A'}</span>
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-600 dark:text-gray-400">üöô</span>
                                    <span class="text-gray-700 dark:text-gray-300 font-mono">${vehicle ? `${vehicle.plate} - ${vehicle.brand} ${vehicle.model}` : 'N/A'}</span>
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-600 dark:text-gray-400">üìÖ</span>
                                    <span class="text-gray-700 dark:text-gray-300">${startTime.toLocaleString('pt-BR')}</span>
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-600 dark:text-gray-400">‚è±Ô∏è</span>
                                    <span class="text-gray-700 dark:text-gray-300">${duration} minutos em tr√¢nsito</span>
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-600 dark:text-gray-400">üìè</span>
                                    <span class="text-gray-700 dark:text-gray-300">${trip.initialKm} km inicial</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateCompletedTripsTable() {
            const tbody = document.getElementById('completedTripsBody');
            const completedTrips = trips.filter(t => t.status === 'completed');
            
            if (completedTrips.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="border border-gray-300 dark:border-gray-600 px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                            Nenhuma viagem encerrada
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = completedTrips.map(trip => {
                const driver = users.find(u => u.id === trip.driverId);
                const vehicle = vehicles.find(v => v.id === trip.vehicleId);
                return `
                    <tr>
                        <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${driver.name}</td>
                        <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${vehicle.plate}</td>
                        <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${trip.destination}</td>
                        <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${new Date(trip.startTime).toLocaleString('pt-BR')}</td>
                        <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${new Date(trip.endTime).toLocaleString('pt-BR')}</td>
                        <td class="border border-gray-300 dark:border-gray-600 px-4 py-2">${trip.kmTraveled} km</td>
                    </tr>
                `;
            }).join('');
        }

        function showActiveTrips() {
            document.getElementById('activeTripsContent').classList.remove('hidden');
            document.getElementById('completedTripsContent').classList.add('hidden');
            document.getElementById('activeTripsTab').className = 'px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold uppercase tracking-wide shadow-lg transition-all duration-300';
            document.getElementById('completedTripsTab').className = 'px-6 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl font-bold uppercase tracking-wide transition-all duration-300';
        }

        function showCompletedTrips() {
            document.getElementById('activeTripsContent').classList.add('hidden');
            document.getElementById('completedTripsContent').classList.remove('hidden');
            document.getElementById('activeTripsTab').className = 'px-6 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl font-bold uppercase tracking-wide transition-all duration-300';
            document.getElementById('completedTripsTab').className = 'px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-bold uppercase tracking-wide shadow-lg transition-all duration-300';
        }

        function exportCSV() {
            const completedTrips = trips.filter(t => t.status === 'completed');
            
            if (completedTrips.length === 0) {
                alert('Nenhuma viagem encerrada para exportar!');
                return;
            }
            
            let csv = 'Motorista,Ve√≠culo,Destino,In√≠cio,Fim,KM Percorrida\n';
            
            completedTrips.forEach(trip => {
                const driver = users.find(u => u.id === trip.driverId);
                const vehicle = vehicles.find(v => v.id === trip.vehicleId);
                csv += `"${driver.name}","${vehicle.plate}","${trip.destination}","${new Date(trip.startTime).toLocaleString('pt-BR')}","${new Date(trip.endTime).toLocaleString('pt-BR')}","${trip.kmTraveled}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `viagens_encerradas_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Search filter for completed trips
        document.getElementById('tripSearchFilter').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#completedTripsBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Initialize theme and load saved config on page load
        initTheme();
        loadSavedConfig();

        

    </script>
    
     <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    // üîë Configure aqui a URL e a Anon Key do seu projeto
    const SUPABASE_URL = "https://xqckqyvmzagkotyzwjbj.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxY2txeXZtemFna290eXp3amJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3MTk4NjcsImV4cCI6MjA3MzI5NTg2N30.eXVAEVoSrMrVu23GKMBnQ7iFIrfEXpZexS7hioIeCH0";
    
    export const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
</script>

<script>
function initSupabase(){
 if(supabaseConfig.url && supabaseConfig.key){
   supabase = window.supabase.createClient(supabaseConfig.url, supabaseConfig.key);
 }
}
(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e1ece1f5d09da8',t:'MTc1NzcwNjUzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
